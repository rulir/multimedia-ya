"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),App=function(){function e(t){_classCallCheck(this,e),this.appEl=t,this.form=this.appEl.querySelector(".source-links-form"),this.form.addEventListener("submit",this._onSourceLinksFormSubmit.bind(this))}return _createClass(e,[{key:"_onSourceLinksFormSubmit",value:function(e){e.preventDefault(),this.urlMap={videoUrl:this.appEl.querySelector("#videoUrl").value,subsUrl:this.appEl.querySelector("#subUrl").value,audioUrl:this.appEl.querySelector("#audioUrl").value},this.appEl.querySelector(".initial-page").classList.add("initial-page_hidden"),this.appEl.querySelector(".video-page").classList.remove("video-page_hidden"),this.canvas=new Canvas(this.appEl.querySelector(".canvas")),this.subs=new Subs(this.urlMap),this.player=new Player(this.appEl.querySelector(".video"),this.urlMap,this.canvas,this.subs)}}]),e}(),Player=function(){function e(t,s,i,a){_classCallCheck(this,e),this.playerEl=t,this.videoUrl=s.videoUrl,this.subsUrl=s.subsUrl,this.canvas=i,this.subs=a,this.subsCurrСue=0,this.videoSourceEl=document.createElement("source"),this.videoSourceEl.setAttribute("src",this.videoUrl),this.playerEl.appendChild(this.videoSourceEl),this.playerEl.addEventListener("play",this._onVideoStartToPlay.bind(this))}return _createClass(e,[{key:"_onVideoStartToPlay",value:function(e){this.checkSubsAvailability(e)!==!1&&(this.setCanvasSizesToVideoSizes(),this.startTimeСountup(),this.watchTheVideo())}},{key:"checkSubsAvailability",value:function(e){if(!this.subs.ready)return e.preventDefault(),this.playerEl.pause(),this.playerEl.currentTime=0,!1}},{key:"setCanvasSizesToVideoSizes",value:function(){this.videoWidth=this.playerEl.clientWidth,this.videoHeight=this.playerEl.clientHeight,this.canvas.canvasEl.width=this.videoWidth,this.canvas.canvasEl.height=this.videoHeight}},{key:"getNeededSubsForThisTime",value:function(){var e=parseInt(1e3*this.playerEl.currentTime),t=this.subs.parsedSubs.filter(function(t){if(t.endTime>=e)return!0});return t}},{key:"startTimeСountup",value:function(){var e=this,t=this.subs.parsedSubs[this.subsCurrСue].endTime-1e3*parseInt(this.playerEl.currentTime),s=this.subs.parsedSubs[this.subsCurrСue].endTime-this.subs.parsedSubs[this.subsCurrСue].startTime,i=setTimeout(function(){e.playerEl.pause(),clearTimeout(i);var t=setTimeout(function(){e.playerEl.play(),e.subsCurrСue<e.subs.parsedSubs.lenght&&e.subsCurrСue++,clearTimeout(t)},s)},t)}},{key:"watchTheVideo",value:function(){var e=this;this.playerEl.paused||this.playerEl.ended||(this.paintFrame(),setTimeout(function(){e.watchTheVideo()},0))}},{key:"paintFrame",value:function(){this.canvas.context.drawImage(this.playerEl,0,0,this.videoWidth,this.videoHeight);for(var e=this.canvas.context.getImageData(0,0,this.videoWidth,this.videoHeight),t=e.data.length/4,s=0;s<t;s++){var i=e.data[4*s+0],a=e.data[4*s+1],r=e.data[4*s+2],n=.21*i+.72*a+.07*r;e.data[4*s+0]=n,e.data[4*s+1]=n,e.data[4*s+2]=n}this.canvas.context.putImageData(e,0,0)}}]),e}(),Canvas=function e(t){_classCallCheck(this,e),this.canvasEl=t,this.context=this.canvasEl.getContext("2d")},Subs=function(){function e(t){var s=this;_classCallCheck(this,e),this.ready=!1,fetch(t.subsUrl).then(function(e){e.text().then(function(e){s.parsedSubs=s.parseFromSrt(e),s.ready=!0})})}return _createClass(e,[{key:"parseFromSrt",value:function(e){function t(e,t){var s=t[e].split(":"),i=s[0],a=Number(s[1]),r=s[2].split(","),n=Number(r[0]),u=Number(r[1]);t[e]=36e5*i+6e4*a+1e3*n+u}var s=parser.fromSrt(e);return s.map(function(e){t("endTime",e),t("startTime",e)}),s}}]),e}(),app=new App(document.querySelector(".app"));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImJ1bmRsZS5qcyJdLCJuYW1lcyI6WyJfY2xhc3NDYWxsQ2hlY2siLCJpbnN0YW5jZSIsIkNvbnN0cnVjdG9yIiwiVHlwZUVycm9yIiwiX2NyZWF0ZUNsYXNzIiwiZGVmaW5lUHJvcGVydGllcyIsInRhcmdldCIsInByb3BzIiwiaSIsImxlbmd0aCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImtleSIsInByb3RvUHJvcHMiLCJzdGF0aWNQcm9wcyIsInByb3RvdHlwZSIsIkFwcCIsImVsIiwidGhpcyIsImFwcEVsIiwiZm9ybSIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwiX29uU291cmNlTGlua3NGb3JtU3VibWl0IiwiYmluZCIsInZhbHVlIiwiZSIsInByZXZlbnREZWZhdWx0IiwidXJsTWFwIiwidmlkZW9VcmwiLCJzdWJzVXJsIiwiYXVkaW9VcmwiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJjYW52YXMiLCJDYW52YXMiLCJzdWJzIiwiU3VicyIsInBsYXllciIsIlBsYXllciIsInBsYXllckVsIiwic3Vic0N1cnLQoXVlIiwidmlkZW9Tb3VyY2VFbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwiX29uVmlkZW9TdGFydFRvUGxheSIsImNoZWNrU3Vic0F2YWlsYWJpbGl0eSIsInNldENhbnZhc1NpemVzVG9WaWRlb1NpemVzIiwic3RhcnRUaW1l0KFvdW50dXAiLCJ3YXRjaFRoZVZpZGVvIiwicmVhZHkiLCJwYXVzZSIsImN1cnJlbnRUaW1lIiwidmlkZW9XaWR0aCIsImNsaWVudFdpZHRoIiwidmlkZW9IZWlnaHQiLCJjbGllbnRIZWlnaHQiLCJjYW52YXNFbCIsIndpZHRoIiwiaGVpZ2h0IiwicGFyc2VJbnQiLCJmaWx0ZXJlZFN1YnMiLCJwYXJzZWRTdWJzIiwiZmlsdGVyIiwiaXRlbSIsImVuZFRpbWUiLCJfdGhpcyIsImRlbGF5VG9TdGFydE9mU3VicyIsInBhdXNlRHVyYXRpb24iLCJzdGFydFRpbWUiLCJ0MSIsInNldFRpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJ0MiIsInBsYXkiLCJsZW5naHQiLCJfdGhpczIiLCJwYXVzZWQiLCJlbmRlZCIsInBhaW50RnJhbWUiLCJjb250ZXh0IiwiZHJhd0ltYWdlIiwiZnJhbWUiLCJnZXRJbWFnZURhdGEiLCJkYXRhIiwiciIsImciLCJiIiwiYXZlcmFnZSIsInB1dEltYWdlRGF0YSIsImdldENvbnRleHQiLCJfdGhpczMiLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJ0ZXh0IiwicGFyc2VGcm9tU3J0Iiwic3J0IiwidGltZVBhcnNlVG9NcyIsInRpbWVUeXBlIiwic3Vic1N0YXJ0VGltZUJ1ZmZlciIsInNwbGl0IiwiaG91cnMiLCJtaW5zIiwiTnVtYmVyIiwic2Vjc0FuZE1zZWNzQnVmZmVyIiwic2VjcyIsIm1zZWNzIiwicGFyc2VyIiwiZnJvbVNydCIsIm1hcCIsImFwcCJdLCJtYXBwaW5ncyI6IkFBQUEsWUNJQSxTQUFTQSxpQkFBZ0JDLEVBQVVDLEdBQWUsS0FBTUQsWUFBb0JDLElBQWdCLEtBQU0sSUFBSUMsV0FBVSxxQ0FGaEgsR0FBSUMsY0FBZSxXQUFjLFFBQVNDLEdBQWlCQyxFQUFRQyxHQUFTLElBQUssR0FBSUMsR0FBSSxFQUFHQSxFQUFJRCxFQUFNRSxPQUFRRCxJQUFLLENBQUUsR0FBSUUsR0FBYUgsRUFBTUMsRUFBSUUsR0FBV0MsV0FBYUQsRUFBV0MsYUFBYyxFQUFPRCxFQUFXRSxjQUFlLEVBQVUsU0FBV0YsS0FBWUEsRUFBV0csVUFBVyxHQUFNQyxPQUFPQyxlQUFlVCxFQUFRSSxFQUFXTSxJQUFLTixJQUFpQixNQUFPLFVBQVVSLEVBQWFlLEVBQVlDLEdBQWlKLE1BQTlIRCxJQUFZWixFQUFpQkgsRUFBWWlCLFVBQVdGLEdBQWlCQyxHQUFhYixFQUFpQkgsRUFBYWdCLEdBQXFC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R0FBSXJCLGdCQUFBc0IsS0FBQWtCLEdBQ2ZsQixLQUFLMEMsU0FBVzNDLEVBQ2hCQyxLQUFLaUUsUUFBVWpFLEtBQUswQyxTQUFTaUMsV0FBVyxPQUlwQ3ZELEtBQUEsV0FDTCxRQUFBQSxHQUFZVixHQUFRLEdBQUFrRSxHQUFBNUUsSUFBQXRCLGlCQUFBc0IsS0FBQW9CLEdBQ25CcEIsS0FBS21DLE9BQVEsRUFDYjBDLE1BQU1uRSxFQUFPRSxTQUNYa0UsS0FBSyxTQUFBQyxHQUNMQSxFQUFJQyxPQUNGRixLQUFLLFNBQUFULEdBQ0xPLEVBQUs3QixXQUFhNkIsRUFBS0ssYUFBYVosR0FDcENPLEVBQUt6QyxPQUFRLE1Db0VsQixNQXZCQXJELGNBQWFzQyxJQUNaMUIsSUFBSyxlQUNMYSxNQUFPLFNEMUNLMkUsR0FRWixRQUFTQyxHQUFjQyxFQUFVbkMsR0FDaEMsR0FBSW9DLEdBQXNCcEMsRUFBS21DLEdBQVVFLE1BQU0sS0FDM0NDLEVBQVFGLEVBQW9CLEdBQzVCRyxFQUFPQyxPQUFPSixFQUFvQixJQUNsQ0ssRUFBcUJMLEVBQW9CLEdBQUdDLE1BQU0sS0FDbERLLEVBQU9GLE9BQU9DLEVBQW1CLElBQ2pDRSxFQUFRSCxPQUFPQyxFQUFtQixHQUN0Q3pDLEdBQUttQyxHQUFvQixLQUFSRyxFQUF5QixJQUFQQyxFQUFzQixJQUFQRyxFQUFjQyxFQWRqRSxHQUFJN0MsR0FBYThDLE9BQU9DLFFBQVFaLEVBZ0JoQyxPQWRBbkMsR0FBV2dELElBQUksU0FBQTlDLEdBQ2RrQyxFQUFjLFVBQVdsQyxHQUN6QmtDLEVBQWMsWUFBYWxDLEtBWXJCRixNQzhDRDNCLEtEMUNGNEUsSUFBTSxHQUFJbEcsS0FBSTRCLFNBQVN2QixjQUFjIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5jbGFzcyBBcHAge1xuXHRjb25zdHJ1Y3RvcihlbCkge1xuXHRcdHRoaXMuYXBwRWwgPSBlbDtcblx0XHR0aGlzLmZvcm0gPSB0aGlzLmFwcEVsLnF1ZXJ5U2VsZWN0b3IoJy5zb3VyY2UtbGlua3MtZm9ybScpO1xuXHRcdHRoaXMuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCB0aGlzLl9vblNvdXJjZUxpbmtzRm9ybVN1Ym1pdC5iaW5kKHRoaXMpKTtcblx0fTtcblxuXHRfb25Tb3VyY2VMaW5rc0Zvcm1TdWJtaXQoZSkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHR0aGlzLnVybE1hcCA9IHtcblx0XHRcdHZpZGVvVXJsOiB0aGlzLmFwcEVsLnF1ZXJ5U2VsZWN0b3IoJyN2aWRlb1VybCcpLnZhbHVlLFxuXHRcdFx0c3Vic1VybDogdGhpcy5hcHBFbC5xdWVyeVNlbGVjdG9yKCcjc3ViVXJsJykudmFsdWUsXG5cdFx0XHRhdWRpb1VybDogdGhpcy5hcHBFbC5xdWVyeVNlbGVjdG9yKCcjYXVkaW9VcmwnKS52YWx1ZSxcblx0XHR9O1xuXHRcdHRoaXMuYXBwRWwucXVlcnlTZWxlY3RvcignLmluaXRpYWwtcGFnZScpLmNsYXNzTGlzdC5hZGQoJ2luaXRpYWwtcGFnZV9oaWRkZW4nKTtcblx0XHR0aGlzLmFwcEVsLnF1ZXJ5U2VsZWN0b3IoJy52aWRlby1wYWdlJykuY2xhc3NMaXN0LnJlbW92ZSgndmlkZW8tcGFnZV9oaWRkZW4nKTtcblxuXHRcdHRoaXMuY2FudmFzID0gbmV3IENhbnZhcyh0aGlzLmFwcEVsLnF1ZXJ5U2VsZWN0b3IoJy5jYW52YXMnKSk7XG5cdFx0dGhpcy5zdWJzID0gbmV3IFN1YnModGhpcy51cmxNYXApO1xuXHRcdHRoaXMucGxheWVyID0gbmV3IFBsYXllcih0aGlzLmFwcEVsLnF1ZXJ5U2VsZWN0b3IoJy52aWRlbycpLCB0aGlzLnVybE1hcCwgdGhpcy5jYW52YXMsIHRoaXMuc3Vicyk7XG5cdH07XG59O1xuXG5jbGFzcyBQbGF5ZXIge1xuXHRjb25zdHJ1Y3RvcihlbCwgdXJsTWFwLCBjYW52YXMsIHN1YnMpIHtcblx0XHR0aGlzLnBsYXllckVsID0gZWw7XG5cdFx0dGhpcy52aWRlb1VybCA9IHVybE1hcC52aWRlb1VybDtcblx0XHR0aGlzLnN1YnNVcmwgPSB1cmxNYXAuc3Vic1VybDtcblx0XHR0aGlzLmNhbnZhcyA9IGNhbnZhcztcblx0XHR0aGlzLnN1YnMgPSBzdWJzO1xuXHRcdHRoaXMuc3Vic0N1cnLQoXVlID0gMDtcblx0XHR0aGlzLnZpZGVvU291cmNlRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcblx0XHR0aGlzLnZpZGVvU291cmNlRWwuc2V0QXR0cmlidXRlKCdzcmMnLCB0aGlzLnZpZGVvVXJsKTtcblx0XHR0aGlzLnBsYXllckVsLmFwcGVuZENoaWxkKHRoaXMudmlkZW9Tb3VyY2VFbCk7XG5cdFx0dGhpcy5wbGF5ZXJFbC5hZGRFdmVudExpc3RlbmVyKCdwbGF5JywgdGhpcy5fb25WaWRlb1N0YXJ0VG9QbGF5LmJpbmQodGhpcykpO1xuXHRcdC8vIHRoaXMucGxheWVyRWwuYWRkRXZlbnRMaXN0ZW5lcignc2Vla2luZycsIHRoaXMuX29uVmlkZW9TZWVraW5nLmJpbmQodGhpcykpO1xuXHR9O1xuXG5cdF9vblZpZGVvU3RhcnRUb1BsYXkoZSkge1xuXHRcdGlmICh0aGlzLmNoZWNrU3Vic0F2YWlsYWJpbGl0eShlKSA9PT0gZmFsc2UpIHtcblx0XHRcdHJldHVybjtcblx0XHR9O1xuXHRcdHRoaXMuc2V0Q2FudmFzU2l6ZXNUb1ZpZGVvU2l6ZXMoKTtcblx0XHR0aGlzLnN0YXJ0VGltZdChb3VudHVwKCk7XG5cdFx0dGhpcy53YXRjaFRoZVZpZGVvKCk7XG5cdH07XG5cblx0Ly8gX29uVmlkZW9TZWVraW5nKGUpIHtcblx0Ly8gXHRmaWx0ZXJQYXJzZWRTdWJzKCk7XG5cdC8vIH07XG5cblx0Y2hlY2tTdWJzQXZhaWxhYmlsaXR5KGUpIHtcblx0XHRpZiAoIXRoaXMuc3Vicy5yZWFkeSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0dGhpcy5wbGF5ZXJFbC5wYXVzZSgpO1xuXHRcdFx0dGhpcy5wbGF5ZXJFbC5jdXJyZW50VGltZSA9IDA7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fTtcblx0fTtcblxuXHRzZXRDYW52YXNTaXplc1RvVmlkZW9TaXplcygpIHtcblx0XHR0aGlzLnZpZGVvV2lkdGggPSB0aGlzLnBsYXllckVsLmNsaWVudFdpZHRoO1xuXHRcdHRoaXMudmlkZW9IZWlnaHQgPSB0aGlzLnBsYXllckVsLmNsaWVudEhlaWdodDtcblx0XHR0aGlzLmNhbnZhcy5jYW52YXNFbC53aWR0aCA9IHRoaXMudmlkZW9XaWR0aDtcblx0XHR0aGlzLmNhbnZhcy5jYW52YXNFbC5oZWlnaHQgPSB0aGlzLnZpZGVvSGVpZ2h0O1xuXHR9O1xuXG5cdGdldE5lZWRlZFN1YnNGb3JUaGlzVGltZSgpIHtcblx0XHRsZXQgY3VycmVudFRpbWUgPSBwYXJzZUludCh0aGlzLnBsYXllckVsLmN1cnJlbnRUaW1lICogMTAwMCk7XG5cdFx0bGV0IGZpbHRlcmVkU3VicyA9IHRoaXMuc3Vicy5wYXJzZWRTdWJzLmZpbHRlcihpdGVtID0+IHtcblx0XHRcdGlmIChpdGVtLmVuZFRpbWUgPj0gY3VycmVudFRpbWUpIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9O1xuXHRcdH0pO1xuXHRcdHJldHVybiBmaWx0ZXJlZFN1YnM7XG5cdH07XG5cblx0Ly8gZmlsdGVyUGFyc2VkU3VicygpIHtcblx0Ly8gXHRpZiAodG8pIHtcblx0Ly8gXHRcdGNsZWFyVGltZW91dCh0byk7XG5cdC8vIFx0fTtcblx0Ly8gXHRsZXQgdG8gPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0Ly8gXHRcdHRoaXMuc3Vicy5wYXJzZWRTdWJzID0gdGhpcy5nZXROZWVkZWRTdWJzRm9yVGhpc1RpbWUoKTtcblx0Ly8gXHR9LCAxMCk7XG5cblx0Ly8gfTtcblxuXHRzdGFydFRpbWXQoW91bnR1cCgpIHtcblx0XHRsZXQgZGVsYXlUb1N0YXJ0T2ZTdWJzID0gdGhpcy5zdWJzLnBhcnNlZFN1YnNbdGhpcy5zdWJzQ3VyctChdWVdLmVuZFRpbWUgLSAocGFyc2VJbnQodGhpcy5wbGF5ZXJFbC5jdXJyZW50VGltZSkgKiAxMDAwKTtcblx0XHRsZXQgcGF1c2VEdXJhdGlvbiA9IHRoaXMuc3Vicy5wYXJzZWRTdWJzW3RoaXMuc3Vic0N1cnLQoXVlXS5lbmRUaW1lIC0gdGhpcy5zdWJzLnBhcnNlZFN1YnNbdGhpcy5zdWJzQ3VyctChdWVdLnN0YXJ0VGltZTtcblxuXHRcdGxldCB0MSA9IHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0dGhpcy5wbGF5ZXJFbC5wYXVzZSgpO1xuXHRcdFx0Y2xlYXJUaW1lb3V0KHQxKTtcblx0XHRcdGxldCB0MiA9IHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHR0aGlzLnBsYXllckVsLnBsYXkoKTtcblx0XHRcdFx0aWYgKHRoaXMuc3Vic0N1cnLQoXVlIDwgdGhpcy5zdWJzLnBhcnNlZFN1YnMubGVuZ2h0KSB7XG5cdFx0XHRcdFx0dGhpcy5zdWJzQ3VyctChdWUrKztcblx0XHRcdFx0fTtcblx0XHRcdFx0Y2xlYXJUaW1lb3V0KHQyKTtcblx0XHRcdH0sIHBhdXNlRHVyYXRpb24pO1xuXHRcdH0sIGRlbGF5VG9TdGFydE9mU3Vicyk7XG5cdH07XG5cblx0d2F0Y2hUaGVWaWRlbygpIHtcblx0XHRpZiAodGhpcy5wbGF5ZXJFbC5wYXVzZWQgfHwgdGhpcy5wbGF5ZXJFbC5lbmRlZCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH07XG5cblx0XHR0aGlzLnBhaW50RnJhbWUoKTtcblxuXHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0dGhpcy53YXRjaFRoZVZpZGVvKCk7XG5cdFx0fSwgMCk7XG5cdH07XG5cblx0cGFpbnRGcmFtZSgpIHtcblx0XHR0aGlzLmNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLnBsYXllckVsLCAwLCAwLCB0aGlzLnZpZGVvV2lkdGgsIHRoaXMudmlkZW9IZWlnaHQpO1xuXHRcdGxldCBmcmFtZSA9IHRoaXMuY2FudmFzLmNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIHRoaXMudmlkZW9XaWR0aCwgdGhpcy52aWRlb0hlaWdodCk7XG5cdFx0bGV0IGxlbmd0aCA9IGZyYW1lLmRhdGEubGVuZ3RoIC8gNDtcblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcblx0XHRcdGxldCByID0gZnJhbWUuZGF0YVtpICogNCArIDBdO1xuXHRcdFx0bGV0IGcgPSBmcmFtZS5kYXRhW2kgKiA0ICsgMV07XG5cdFx0XHRsZXQgYiA9IGZyYW1lLmRhdGFbaSAqIDQgKyAyXTtcblx0XHRcdGxldCBhdmVyYWdlID0gMC4yMSAqIHIgKyAwLjcyICogZyArIDAuMDcgKiBiO1xuXHRcdFx0ZnJhbWUuZGF0YVtpICogNCArIDBdID0gYXZlcmFnZTtcblx0XHRcdGZyYW1lLmRhdGFbaSAqIDQgKyAxXSA9IGF2ZXJhZ2U7XG5cdFx0XHRmcmFtZS5kYXRhW2kgKiA0ICsgMl0gPSBhdmVyYWdlO1xuXHRcdH07XG5cblx0XHR0aGlzLmNhbnZhcy5jb250ZXh0LnB1dEltYWdlRGF0YShmcmFtZSwgMCwgMCk7XG5cdH07XG59O1xuXG5jbGFzcyBDYW52YXMge1xuXHRjb25zdHJ1Y3RvcihlbCkge1xuXHRcdHRoaXMuY2FudmFzRWwgPSBlbDtcblx0XHR0aGlzLmNvbnRleHQgPSB0aGlzLmNhbnZhc0VsLmdldENvbnRleHQoXCIyZFwiKTtcblx0fTtcbn07XG5cbmNsYXNzIFN1YnMge1xuXHRjb25zdHJ1Y3Rvcih1cmxNYXApIHtcblx0XHR0aGlzLnJlYWR5ID0gZmFsc2U7XG5cdFx0ZmV0Y2godXJsTWFwLnN1YnNVcmwpXG5cdFx0XHQudGhlbihyZXMgPT4ge1xuXHRcdFx0XHRyZXMudGV4dCgpXG5cdFx0XHRcdFx0LnRoZW4oZGF0YSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLnBhcnNlZFN1YnMgPSB0aGlzLnBhcnNlRnJvbVNydChkYXRhKTtcblx0XHRcdFx0XHRcdHRoaXMucmVhZHkgPSB0cnVlO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdH07XG5cblx0cGFyc2VGcm9tU3J0KHNydCkge1xuXHRcdGxldCBwYXJzZWRTdWJzID0gcGFyc2VyLmZyb21TcnQoc3J0KTtcblxuXHRcdHBhcnNlZFN1YnMubWFwKGl0ZW0gPT4ge1xuXHRcdFx0dGltZVBhcnNlVG9NcygnZW5kVGltZScsIGl0ZW0pO1xuXHRcdFx0dGltZVBhcnNlVG9Ncygnc3RhcnRUaW1lJywgaXRlbSk7XG5cdFx0fSk7XG5cblx0XHRmdW5jdGlvbiB0aW1lUGFyc2VUb01zKHRpbWVUeXBlLCBpdGVtKSB7XG5cdFx0XHRsZXQgc3Vic1N0YXJ0VGltZUJ1ZmZlciA9IGl0ZW1bdGltZVR5cGVdLnNwbGl0KCc6Jyk7XG5cdFx0XHRsZXQgaG91cnMgPSBzdWJzU3RhcnRUaW1lQnVmZmVyWzBdO1xuXHRcdFx0bGV0IG1pbnMgPSBOdW1iZXIoc3Vic1N0YXJ0VGltZUJ1ZmZlclsxXSk7XG5cdFx0XHRsZXQgc2Vjc0FuZE1zZWNzQnVmZmVyID0gc3Vic1N0YXJ0VGltZUJ1ZmZlclsyXS5zcGxpdCgnLCcpO1xuXHRcdFx0bGV0IHNlY3MgPSBOdW1iZXIoc2Vjc0FuZE1zZWNzQnVmZmVyWzBdKTtcblx0XHRcdGxldCBtc2VjcyA9IE51bWJlcihzZWNzQW5kTXNlY3NCdWZmZXJbMV0pO1xuXHRcdFx0aXRlbVt0aW1lVHlwZV0gPSBob3VycyAqIDM2MDAwMDAgKyBtaW5zICogNjAwMDAgKyBzZWNzICogMTAwMCArIG1zZWNzO1xuXHRcdH07XG5cdFx0cmV0dXJuIHBhcnNlZFN1YnM7XG5cdH07XG59O1xuXG5jb25zdCBhcHAgPSBuZXcgQXBwKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hcHAnKSk7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbnZhciBBcHAgPSBmdW5jdGlvbiAoKSB7XG5cdGZ1bmN0aW9uIEFwcChlbCkge1xuXHRcdF9jbGFzc0NhbGxDaGVjayh0aGlzLCBBcHApO1xuXG5cdFx0dGhpcy5hcHBFbCA9IGVsO1xuXHRcdHRoaXMuZm9ybSA9IHRoaXMuYXBwRWwucXVlcnlTZWxlY3RvcignLnNvdXJjZS1saW5rcy1mb3JtJyk7XG5cdFx0dGhpcy5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIHRoaXMuX29uU291cmNlTGlua3NGb3JtU3VibWl0LmJpbmQodGhpcykpO1xuXHR9XG5cblx0X2NyZWF0ZUNsYXNzKEFwcCwgW3tcblx0XHRrZXk6ICdfb25Tb3VyY2VMaW5rc0Zvcm1TdWJtaXQnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBfb25Tb3VyY2VMaW5rc0Zvcm1TdWJtaXQoZSkge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0dGhpcy51cmxNYXAgPSB7XG5cdFx0XHRcdHZpZGVvVXJsOiB0aGlzLmFwcEVsLnF1ZXJ5U2VsZWN0b3IoJyN2aWRlb1VybCcpLnZhbHVlLFxuXHRcdFx0XHRzdWJzVXJsOiB0aGlzLmFwcEVsLnF1ZXJ5U2VsZWN0b3IoJyNzdWJVcmwnKS52YWx1ZSxcblx0XHRcdFx0YXVkaW9Vcmw6IHRoaXMuYXBwRWwucXVlcnlTZWxlY3RvcignI2F1ZGlvVXJsJykudmFsdWVcblx0XHRcdH07XG5cdFx0XHR0aGlzLmFwcEVsLnF1ZXJ5U2VsZWN0b3IoJy5pbml0aWFsLXBhZ2UnKS5jbGFzc0xpc3QuYWRkKCdpbml0aWFsLXBhZ2VfaGlkZGVuJyk7XG5cdFx0XHR0aGlzLmFwcEVsLnF1ZXJ5U2VsZWN0b3IoJy52aWRlby1wYWdlJykuY2xhc3NMaXN0LnJlbW92ZSgndmlkZW8tcGFnZV9oaWRkZW4nKTtcblxuXHRcdFx0dGhpcy5jYW52YXMgPSBuZXcgQ2FudmFzKHRoaXMuYXBwRWwucXVlcnlTZWxlY3RvcignLmNhbnZhcycpKTtcblx0XHRcdHRoaXMuc3VicyA9IG5ldyBTdWJzKHRoaXMudXJsTWFwKTtcblx0XHRcdHRoaXMucGxheWVyID0gbmV3IFBsYXllcih0aGlzLmFwcEVsLnF1ZXJ5U2VsZWN0b3IoJy52aWRlbycpLCB0aGlzLnVybE1hcCwgdGhpcy5jYW52YXMsIHRoaXMuc3Vicyk7XG5cdFx0fVxuXHR9XSk7XG5cblx0cmV0dXJuIEFwcDtcbn0oKTtcblxuO1xuXG52YXIgUGxheWVyID0gZnVuY3Rpb24gKCkge1xuXHRmdW5jdGlvbiBQbGF5ZXIoZWwsIHVybE1hcCwgY2FudmFzLCBzdWJzKSB7XG5cdFx0X2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBsYXllcik7XG5cblx0XHR0aGlzLnBsYXllckVsID0gZWw7XG5cdFx0dGhpcy52aWRlb1VybCA9IHVybE1hcC52aWRlb1VybDtcblx0XHR0aGlzLnN1YnNVcmwgPSB1cmxNYXAuc3Vic1VybDtcblx0XHR0aGlzLmNhbnZhcyA9IGNhbnZhcztcblx0XHR0aGlzLnN1YnMgPSBzdWJzO1xuXHRcdHRoaXMuc3Vic0N1cnLQoXVlID0gMDtcblx0XHR0aGlzLnZpZGVvU291cmNlRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzb3VyY2UnKTtcblx0XHR0aGlzLnZpZGVvU291cmNlRWwuc2V0QXR0cmlidXRlKCdzcmMnLCB0aGlzLnZpZGVvVXJsKTtcblx0XHR0aGlzLnBsYXllckVsLmFwcGVuZENoaWxkKHRoaXMudmlkZW9Tb3VyY2VFbCk7XG5cdFx0dGhpcy5wbGF5ZXJFbC5hZGRFdmVudExpc3RlbmVyKCdwbGF5JywgdGhpcy5fb25WaWRlb1N0YXJ0VG9QbGF5LmJpbmQodGhpcykpO1xuXHRcdC8vIHRoaXMucGxheWVyRWwuYWRkRXZlbnRMaXN0ZW5lcignc2Vla2luZycsIHRoaXMuX29uVmlkZW9TZWVraW5nLmJpbmQodGhpcykpO1xuXHR9XG5cblx0X2NyZWF0ZUNsYXNzKFBsYXllciwgW3tcblx0XHRrZXk6ICdfb25WaWRlb1N0YXJ0VG9QbGF5Jyxcblx0XHR2YWx1ZTogZnVuY3Rpb24gX29uVmlkZW9TdGFydFRvUGxheShlKSB7XG5cdFx0XHRpZiAodGhpcy5jaGVja1N1YnNBdmFpbGFiaWxpdHkoZSkgPT09IGZhbHNlKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH07XG5cdFx0XHR0aGlzLnNldENhbnZhc1NpemVzVG9WaWRlb1NpemVzKCk7XG5cdFx0XHR0aGlzLnN0YXJ0VGltZdChb3VudHVwKCk7XG5cdFx0XHR0aGlzLndhdGNoVGhlVmlkZW8oKTtcblx0XHR9XG5cdH0sIHtcblx0XHRrZXk6ICdjaGVja1N1YnNBdmFpbGFiaWxpdHknLFxuXG5cblx0XHQvLyBfb25WaWRlb1NlZWtpbmcoZSkge1xuXHRcdC8vIFx0ZmlsdGVyUGFyc2VkU3VicygpO1xuXHRcdC8vIH07XG5cblx0XHR2YWx1ZTogZnVuY3Rpb24gY2hlY2tTdWJzQXZhaWxhYmlsaXR5KGUpIHtcblx0XHRcdGlmICghdGhpcy5zdWJzLnJlYWR5KSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0dGhpcy5wbGF5ZXJFbC5wYXVzZSgpO1xuXHRcdFx0XHR0aGlzLnBsYXllckVsLmN1cnJlbnRUaW1lID0gMDtcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fTtcblx0XHR9XG5cdH0sIHtcblx0XHRrZXk6ICdzZXRDYW52YXNTaXplc1RvVmlkZW9TaXplcycsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIHNldENhbnZhc1NpemVzVG9WaWRlb1NpemVzKCkge1xuXHRcdFx0dGhpcy52aWRlb1dpZHRoID0gdGhpcy5wbGF5ZXJFbC5jbGllbnRXaWR0aDtcblx0XHRcdHRoaXMudmlkZW9IZWlnaHQgPSB0aGlzLnBsYXllckVsLmNsaWVudEhlaWdodDtcblx0XHRcdHRoaXMuY2FudmFzLmNhbnZhc0VsLndpZHRoID0gdGhpcy52aWRlb1dpZHRoO1xuXHRcdFx0dGhpcy5jYW52YXMuY2FudmFzRWwuaGVpZ2h0ID0gdGhpcy52aWRlb0hlaWdodDtcblx0XHR9XG5cdH0sIHtcblx0XHRrZXk6ICdnZXROZWVkZWRTdWJzRm9yVGhpc1RpbWUnLFxuXHRcdHZhbHVlOiBmdW5jdGlvbiBnZXROZWVkZWRTdWJzRm9yVGhpc1RpbWUoKSB7XG5cdFx0XHR2YXIgY3VycmVudFRpbWUgPSBwYXJzZUludCh0aGlzLnBsYXllckVsLmN1cnJlbnRUaW1lICogMTAwMCk7XG5cdFx0XHR2YXIgZmlsdGVyZWRTdWJzID0gdGhpcy5zdWJzLnBhcnNlZFN1YnMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7XG5cdFx0XHRcdGlmIChpdGVtLmVuZFRpbWUgPj0gY3VycmVudFRpbWUpIHtcblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIGZpbHRlcmVkU3Vicztcblx0XHR9XG5cdH0sIHtcblx0XHRrZXk6ICdzdGFydFRpbWXQoW91bnR1cCcsXG5cblxuXHRcdC8vIGZpbHRlclBhcnNlZFN1YnMoKSB7XG5cdFx0Ly8gXHRpZiAodG8pIHtcblx0XHQvLyBcdFx0Y2xlYXJUaW1lb3V0KHRvKTtcblx0XHQvLyBcdH07XG5cdFx0Ly8gXHRsZXQgdG8gPSBzZXRUaW1lb3V0KCgpID0+IHtcblx0XHQvLyBcdFx0dGhpcy5zdWJzLnBhcnNlZFN1YnMgPSB0aGlzLmdldE5lZWRlZFN1YnNGb3JUaGlzVGltZSgpO1xuXHRcdC8vIFx0fSwgMTApO1xuXG5cdFx0Ly8gfTtcblxuXHRcdHZhbHVlOiBmdW5jdGlvbiBzdGFydFRpbWVPdW50dXAoKSB7XG5cdFx0XHR2YXIgX3RoaXMgPSB0aGlzO1xuXG5cdFx0XHR2YXIgZGVsYXlUb1N0YXJ0T2ZTdWJzID0gdGhpcy5zdWJzLnBhcnNlZFN1YnNbdGhpcy5zdWJzQ3VyctChdWVdLmVuZFRpbWUgLSBwYXJzZUludCh0aGlzLnBsYXllckVsLmN1cnJlbnRUaW1lKSAqIDEwMDA7XG5cdFx0XHR2YXIgcGF1c2VEdXJhdGlvbiA9IHRoaXMuc3Vicy5wYXJzZWRTdWJzW3RoaXMuc3Vic0N1cnLQoXVlXS5lbmRUaW1lIC0gdGhpcy5zdWJzLnBhcnNlZFN1YnNbdGhpcy5zdWJzQ3VyctChdWVdLnN0YXJ0VGltZTtcblxuXHRcdFx0dmFyIHQxID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG5cdFx0XHRcdF90aGlzLnBsYXllckVsLnBhdXNlKCk7XG5cdFx0XHRcdGNsZWFyVGltZW91dCh0MSk7XG5cdFx0XHRcdHZhciB0MiA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRcdF90aGlzLnBsYXllckVsLnBsYXkoKTtcblx0XHRcdFx0XHRpZiAoX3RoaXMuc3Vic0N1cnLQoXVlIDwgX3RoaXMuc3Vicy5wYXJzZWRTdWJzLmxlbmdodCkge1xuXHRcdFx0XHRcdFx0X3RoaXMuc3Vic0N1cnLQoXVlKys7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRjbGVhclRpbWVvdXQodDIpO1xuXHRcdFx0XHR9LCBwYXVzZUR1cmF0aW9uKTtcblx0XHRcdH0sIGRlbGF5VG9TdGFydE9mU3Vicyk7XG5cdFx0fVxuXHR9LCB7XG5cdFx0a2V5OiAnd2F0Y2hUaGVWaWRlbycsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIHdhdGNoVGhlVmlkZW8oKSB7XG5cdFx0XHR2YXIgX3RoaXMyID0gdGhpcztcblxuXHRcdFx0aWYgKHRoaXMucGxheWVyRWwucGF1c2VkIHx8IHRoaXMucGxheWVyRWwuZW5kZWQpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fTtcblxuXHRcdFx0dGhpcy5wYWludEZyYW1lKCk7XG5cblx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuXHRcdFx0XHRfdGhpczIud2F0Y2hUaGVWaWRlbygpO1xuXHRcdFx0fSwgMCk7XG5cdFx0fVxuXHR9LCB7XG5cdFx0a2V5OiAncGFpbnRGcmFtZScsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIHBhaW50RnJhbWUoKSB7XG5cdFx0XHR0aGlzLmNhbnZhcy5jb250ZXh0LmRyYXdJbWFnZSh0aGlzLnBsYXllckVsLCAwLCAwLCB0aGlzLnZpZGVvV2lkdGgsIHRoaXMudmlkZW9IZWlnaHQpO1xuXHRcdFx0dmFyIGZyYW1lID0gdGhpcy5jYW52YXMuY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgdGhpcy52aWRlb1dpZHRoLCB0aGlzLnZpZGVvSGVpZ2h0KTtcblx0XHRcdHZhciBsZW5ndGggPSBmcmFtZS5kYXRhLmxlbmd0aCAvIDQ7XG5cblx0XHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0dmFyIHIgPSBmcmFtZS5kYXRhW2kgKiA0ICsgMF07XG5cdFx0XHRcdHZhciBnID0gZnJhbWUuZGF0YVtpICogNCArIDFdO1xuXHRcdFx0XHR2YXIgYiA9IGZyYW1lLmRhdGFbaSAqIDQgKyAyXTtcblx0XHRcdFx0dmFyIGF2ZXJhZ2UgPSAwLjIxICogciArIDAuNzIgKiBnICsgMC4wNyAqIGI7XG5cdFx0XHRcdGZyYW1lLmRhdGFbaSAqIDQgKyAwXSA9IGF2ZXJhZ2U7XG5cdFx0XHRcdGZyYW1lLmRhdGFbaSAqIDQgKyAxXSA9IGF2ZXJhZ2U7XG5cdFx0XHRcdGZyYW1lLmRhdGFbaSAqIDQgKyAyXSA9IGF2ZXJhZ2U7XG5cdFx0XHR9O1xuXG5cdFx0XHR0aGlzLmNhbnZhcy5jb250ZXh0LnB1dEltYWdlRGF0YShmcmFtZSwgMCwgMCk7XG5cdFx0fVxuXHR9XSk7XG5cblx0cmV0dXJuIFBsYXllcjtcbn0oKTtcblxuO1xuXG52YXIgQ2FudmFzID0gZnVuY3Rpb24gQ2FudmFzKGVsKSB7XG5cdF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDYW52YXMpO1xuXG5cdHRoaXMuY2FudmFzRWwgPSBlbDtcblx0dGhpcy5jb250ZXh0ID0gdGhpcy5jYW52YXNFbC5nZXRDb250ZXh0KFwiMmRcIik7XG59O1xuXG47XG5cbnZhciBTdWJzID0gZnVuY3Rpb24gKCkge1xuXHRmdW5jdGlvbiBTdWJzKHVybE1hcCkge1xuXHRcdHZhciBfdGhpczMgPSB0aGlzO1xuXG5cdFx0X2NsYXNzQ2FsbENoZWNrKHRoaXMsIFN1YnMpO1xuXG5cdFx0dGhpcy5yZWFkeSA9IGZhbHNlO1xuXHRcdGZldGNoKHVybE1hcC5zdWJzVXJsKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcblx0XHRcdHJlcy50ZXh0KCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuXHRcdFx0XHRfdGhpczMucGFyc2VkU3VicyA9IF90aGlzMy5wYXJzZUZyb21TcnQoZGF0YSk7XG5cdFx0XHRcdF90aGlzMy5yZWFkeSA9IHRydWU7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fVxuXG5cdF9jcmVhdGVDbGFzcyhTdWJzLCBbe1xuXHRcdGtleTogJ3BhcnNlRnJvbVNydCcsXG5cdFx0dmFsdWU6IGZ1bmN0aW9uIHBhcnNlRnJvbVNydChzcnQpIHtcblx0XHRcdHZhciBwYXJzZWRTdWJzID0gcGFyc2VyLmZyb21TcnQoc3J0KTtcblxuXHRcdFx0cGFyc2VkU3Vicy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcblx0XHRcdFx0dGltZVBhcnNlVG9NcygnZW5kVGltZScsIGl0ZW0pO1xuXHRcdFx0XHR0aW1lUGFyc2VUb01zKCdzdGFydFRpbWUnLCBpdGVtKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRmdW5jdGlvbiB0aW1lUGFyc2VUb01zKHRpbWVUeXBlLCBpdGVtKSB7XG5cdFx0XHRcdHZhciBzdWJzU3RhcnRUaW1lQnVmZmVyID0gaXRlbVt0aW1lVHlwZV0uc3BsaXQoJzonKTtcblx0XHRcdFx0dmFyIGhvdXJzID0gc3Vic1N0YXJ0VGltZUJ1ZmZlclswXTtcblx0XHRcdFx0dmFyIG1pbnMgPSBOdW1iZXIoc3Vic1N0YXJ0VGltZUJ1ZmZlclsxXSk7XG5cdFx0XHRcdHZhciBzZWNzQW5kTXNlY3NCdWZmZXIgPSBzdWJzU3RhcnRUaW1lQnVmZmVyWzJdLnNwbGl0KCcsJyk7XG5cdFx0XHRcdHZhciBzZWNzID0gTnVtYmVyKHNlY3NBbmRNc2Vjc0J1ZmZlclswXSk7XG5cdFx0XHRcdHZhciBtc2VjcyA9IE51bWJlcihzZWNzQW5kTXNlY3NCdWZmZXJbMV0pO1xuXHRcdFx0XHRpdGVtW3RpbWVUeXBlXSA9IGhvdXJzICogMzYwMDAwMCArIG1pbnMgKiA2MDAwMCArIHNlY3MgKiAxMDAwICsgbXNlY3M7XG5cdFx0XHR9O1xuXHRcdFx0cmV0dXJuIHBhcnNlZFN1YnM7XG5cdFx0fVxuXHR9XSk7XG5cblx0cmV0dXJuIFN1YnM7XG59KCk7XG5cbjtcblxudmFyIGFwcCA9IG5ldyBBcHAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFwcCcpKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
